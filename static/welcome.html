<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="style/base.css" type="text/css" />
    </head>
    <body style="margin: 0">
        <div class="jumbotron">
            <div class="container">
                <h1>Graph Peak Caller</h1>
                <br>
                <p>This is a Galaxy server intended for running <a href="http://github.com/uio-bmi/graph_peak_caller" target="_blank"><b>Graph Peak Caller</b></a> and <a href="https://github.com/vgteam/vg" target="_blank"><b>vg</b></a>.</p>
                <p>Check out the simple tutorial below to get started!</p>

            </div>
            <br>
        </div>
        <div class="container">

            <h1>Overview</h1>
            <p>This Galaxy server contains 4 tools making it possible to run a simple graph-based ChIP-seq pipeline, going from raw ChIP-seq reads to peaks:</p>
            <ul>
                <li><i>vg map</i>: A simple wrapper around vg, making it possible to map reads to one of our pre-compiled graphs</li>
                <li><i>vg filter</i>: Filtering reads mapped with vg map</li>
                <li><i>Convert GAM to JSON</i>: A simple wrapper around the <i>vg view</i> command, converting the output from vg map to a format accepted by Graph Peak Caller</li>
                <li><i>Graph Peak Caller</i>: Takes vg JSON alignments as input and calls peaks on one of our pre-compiled graph-based reference genomes.</li>
            </ul>
            <p>This server currently have pre-compiled graph-based reference genomes for Arabidopsis Thaliana and Drosophila Melanogaster. Feel free to contact us if you have suggestions for other genomes we should support.
                Also, note that if you have your own graph-based reference genome, you can use <a href="https://github.com/uio-bmi/graph_peak_caller/wiki/Graph-based-ChIP-seq-tutorial" target="_blank">Graph Peak Caller and vg from the command line</a>.</p>
            <p>All credits for <i>vg</i> goes to the developers of <i>vg</i>. This Galaxy server only implements a simple wrapper around vg.</p>
            <br>
            <hr>
            <br>

            <h1>Tutorial: Running a graph-based ChIP-seq pipeline using vg and Graph Peak Caller</h1>
            <p>In this tutorial, we will look at the Drosophila Melanogaster JRA transcription factor. The raw ChIP-seq data we will use is collected from <a href="https://www.encodeproject.org/experiments/ENCSR471GSA" target="_blank">this ENCODE experiment</a>.
                If you want to use your own data, you can upload your own fastq file using the Galaxy <i>Get Data</i> tool.</p>

            <p><b>Tip:</b> When doing this tutorial, you will be navigating around galaxy. If you need to get back to this page, you can simply click the Galaxy logo in the top left corner.</p>
            <br>
            <h4>Step 1: Preparing the data</h4>
            <p><a href="https://hyperbrowser.uio.no/graph-peak-caller/u/ivar/h/drosophila-melanogaster-example">Click here</a> to go
                to our example history which contains the fastq data set that we will use in this tutorial.
                When clicking the link, you will be sent to a new page where you will see the example history.
                Simply click on the <b>Swith to this history</b> link in the top right corner, and you will import the history and automatically be sent back to this page.</p>
            <br>
            <h4>Step 2: Map reads using vg</h4>
            <p>By following the instructinos in step 1, you should now see a history on the right side of the screen showing the <b>ENCFF888CHA.fastq</b> dataset.
            We will now map these reads to a the Drosophila Melanogaster Graph-Based reference. Go to the <b>vg map</b> tool by expanding the <b>vg tools</b> sub-menu in the left menu and clicking <b>Map reads to graph</b>.</p>
            <p>Your fastq dataset should be pre-selected as input, so all you need to do is clicking the <b>Execute</b> button. A new history element appearing on the right side of your screen will turn green once mapping is finished. This should take a few minutes.</p>
            <br>
            <h4>Step 3: Filtering </h4>
            <p>Fro step 2, you now have a vg GAM file in you history. This is a binary file containing the paths (positions) that vg found for each read in the graph.
                We want to filter out only the alignments that vg are certiain about. Do this by using the <b>Filter mapped vg reads</b>  tool, which you will find under <b>vg tools</b> in the left menu.
                Make sure that the output from the previous tool is selected as input (it is by default). Setting <i>Minimum PHRED mapping quality required to keep a read</i> to <i>60</i> and <i>Minimum identity</i> to 0.95 should be fine for this tutorial.
                Press the <b>Execute</b> button and return back to this page.</p>
            <br>
            <h4>Step 4: Convert to JSON</h4>
            <p>Graph Peak Caller will only accept JSON input. Thus, we need to convert the GAM ouput from the previous tool to JSON by running the <b>Convert GAM to JSON</b> tool (which also is found under <b>vg tools</b>). As input, select the output from the filter tool (should be pre-selected).</p>
            <br>
            <h4>Step 5: Run Peak Calling</h4>
            <p>Go to the <b>Graph Peak Caller</b> tool found under the <b>Graph Peak Caller</b> sub-menu on the left. As <i>Sample reads</i> select the JSON output from the previous tool. We do not have a separate control track (if you have, you simply select a control track in the input titled <i>Control reads mapped with vg (optional)</i>).</p>
            <p>Make sure that <i>Genome</i>is set to <b>Drosophila Melanogaster</b>. Our read length is <b>50</b> and fragment length is <b>230</b>.</p>
            <p>Press <b>Execute.</b>. This should take about 10-20 minutes. The tool produces several output files (see below).</p>
            <hr>

            <h4>Output files</h4>
            <p>Graph Peak caller will produce peaks in multiple formats, making it easier for the user to find a format that is suitable for further analysis.</p>
            <ul>
                <li><i>peaks.intervalcollection</i>: This is a file containing peaks represented as intervals on the graph in a JSON format. This file can be imported programatically by Graph Peak Caller.</li>
                <li><i>peaks.fasta</i>: The fasta sequence of all the peaks.</li>
                <li><i>differentially_expressed.csv</i>: A list of peaks that are differentially expressed..</li>
                <li><i>approx_linear_peaks.bed</i>: Approximate position of peaks on the linear reference genome that the graph is based on.</li>
            </ul>

            <h1>Data</h1>

            <hr>
        </div>
        </p>
    </body>
</html>
